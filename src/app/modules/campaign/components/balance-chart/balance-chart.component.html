<div class="card mb-4" *ngIf="campaign">
  <div class="card-header">
    <h5 class="mb-0">
      <i class="fas fa-chart-line me-2 text-primary"></i>
      Campaign Performance Analytics
    </h5>
  </div>
  
  <div class="card-body">
    <!-- Stats Summary -->
    <div class="row mb-4">
      <div class="col-md-3 col-6">
        <div class="stats-card text-center">
          <div class="stat-value" [ngClass]="{
            'text-success': campaign.current_balance >= campaign.start_balance,
            'text-danger': campaign.current_balance < campaign.start_balance
          }">
            {{ campaign.current_balance | currencyFormat }}
          </div>
          <div class="stat-label">Current Balance</div>
        </div>
      </div>
      <div class="col-md-3 col-6">
        <div class="stats-card text-center">
          <div class="stat-value text-info">
            {{ performanceStats.winRate }}%
          </div>
          <div class="stat-label">Win Rate</div>
        </div>
      </div>
      <div class="col-md-3 col-6">
        <div class="stats-card text-center">
          <div class="stat-value" [ngClass]="{
            'text-success': performanceStats.totalProfit > 0,
            'text-danger': performanceStats.totalProfit < 0
          }">
            {{ performanceStats.totalProfit | currencyFormat }}
          </div>
          <div class="stat-label">Total P/L</div>
        </div>
      </div>
      <div class="col-md-3 col-6">
        <div class="stats-card text-center">
          <div class="stat-value text-warning">
            {{ performanceStats.totalBets }}
          </div>
          <div class="stat-label">Total Bets</div>
        </div>
      </div>
    </div>

    <!-- Chart Row -->
    <div class="row">
      <!-- Balance Timeline Chart -->
      <div class="col-lg-8">
        <div class="card">
          <div class="card-header">
            <h6 class="mb-0">
              <i class="fas fa-wave-square me-2"></i>
              Balance Timeline
              <small class="text-muted ms-2">
                (T=Transaction, B=Bet)
              </small>
            </h6>
          </div>
          <div class="card-body">
            <div style="position: relative; height: 300px;">
              <canvas baseChart
                [data]="lineChartData"
                [options]="lineChartOptions"
                [type]="'line'">
              </canvas>
            </div>
            <div class="chart-legend mt-3">
              <div class="row">
                <div class="col-md-6">
                  <span class="legend-item">
                    <span class="legend-color" style="background-color: #3498db;"></span>
                    Balance Progress
                  </span>
                </div>
                <div class="col-md-6 text-end">
                  <small class="text-muted">
                    Start: {{ campaign.start_balance | currencyFormat }} 
                    | Current: {{ campaign.current_balance | currencyFormat }}
                  </small>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Performance Doughnut Chart -->
      <div class="col-lg-4">
        <div class="card">
          <div class="card-header">
            <h6 class="mb-0">
              <i class="fas fa-chart-pie me-2"></i>
              Bet Performance
            </h6>
          </div>
          <div class="card-body">
            <div style="position: relative; height: 250px;">
              <canvas baseChart
                [data]="doughnutChartData"
                [options]="doughnutChartOptions"
                [type]="doughnutChartType">
              </canvas>
            </div>
            <div class="performance-stats mt-3">
              <div class="d-flex justify-content-between mb-2">
                <span>Total Bets:</span>
                <strong>{{ performanceStats.totalBets }}</strong>
              </div>
              <div class="d-flex justify-content-between mb-2">
                <span>Total Staked:</span>
                <strong>{{ performanceStats.totalStaked | currencyFormat }}</strong>
              </div>
              <div class="d-flex justify-content-between mb-2">
                <span>Average Odds:</span>
                <strong>{{ performanceStats.avgOdds }}</strong>
              </div>
              <div class="d-flex justify-content-between">
                <span>Profit/Loss:</span>
                <strong [ngClass]="{
                  'text-success': performanceStats.totalProfit > 0,
                  'text-danger': performanceStats.totalProfit < 0
                }">
                  {{ performanceStats.totalProfit | currencyFormat }}
                </strong>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Detailed Stats -->
    <div class="row mt-4">
      <!-- Transaction Stats -->
      <div class="col-md-6">
        <div class="card">
          <div class="card-header">
            <h6 class="mb-0">
              <i class="fas fa-exchange-alt me-2 text-success"></i>
              Transaction Statistics
            </h6>
          </div>
          <div class="card-body">
            <div class="row">
              <div class="col-6">
                <div class="mb-3">
                  <small class="text-muted d-block">Total Deposits</small>
                  <strong class="text-success">
                    {{ transactionStats.totalDeposits | currencyFormat }}
                  </strong>
                  <small class="d-block text-muted">
                    ({{ transactionStats.depositCount }} transactions)
                  </small>
                </div>
                <div>
                  <small class="text-muted d-block">Largest Deposit</small>
                  <strong>{{ transactionStats.largestDeposit | currencyFormat }}</strong>
                </div>
              </div>
              <div class="col-6">
                <div class="mb-3">
                  <small class="text-muted d-block">Total Withdrawals</small>
                  <strong class="text-danger">
                    {{ transactionStats.totalWithdrawals | currencyFormat }}
                  </strong>
                  <small class="d-block text-muted">
                    ({{ transactionStats.withdrawalCount }} transactions)
                  </small>
                </div>
                <div>
                  <small class="text-muted d-block">Largest Withdrawal</small>
                  <strong>{{ transactionStats.largestWithdrawal | currencyFormat }}</strong>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Bet Stats -->
      <div class="col-md-6">
        <div class="card">
          <div class="card-header">
            <h6 class="mb-0">
              <i class="fas fa-trophy me-2 text-warning"></i>
              Betting Statistics
            </h6>
          </div>
          <div class="card-body">
            <div class="row">
              <div class="col-6">
                <div class="mb-3">
                  <small class="text-muted d-block">Wins</small>
                  <strong class="text-success">{{ performanceStats.wins }}</strong>
                </div>
                <div>
                  <small class="text-muted d-block">Losses</small>
                  <strong class="text-danger">{{ performanceStats.losses }}</strong>
                </div>
              </div>
              <div class="col-6">
                <div class="mb-3">
                  <small class="text-muted d-block">Pending</small>
                  <strong class="text-warning">{{ performanceStats.pending }}</strong>
                </div>
                <div>
                  <small class="text-muted d-block">Win Rate</small>
                  <strong>{{ performanceStats.winRate }}%</strong>
                </div>
              </div>
            </div>
            <div class="progress mt-2" style="height: 8px;">
              <div class="progress-bar bg-success" 
                   [style.width.%]="performanceStats.totalBets > 0 ? 
                   (performanceStats.wins / performanceStats.totalBets) * 100 : 0">
              </div>
              <div class="progress-bar bg-danger" 
                   [style.width.%]="performanceStats.totalBets > 0 ? 
                   (performanceStats.losses / performanceStats.totalBets) * 100 : 0">
              </div>
              <div class="progress-bar bg-warning" 
                   [style.width.%]="performanceStats.totalBets > 0 ? 
                   (performanceStats.pending / performanceStats.totalBets) * 100 : 0">
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Loading State -->
<div class="card mb-4" *ngIf="!campaign">
  <div class="card-body text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading charts...</span>
    </div>
    <p class="mt-3 text-muted">Loading campaign data...</p>
  </div>
</div>