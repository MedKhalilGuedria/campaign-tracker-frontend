<div class="currency-selector">
  <button class="currency-toggle btn btn-outline-secondary" 
          (click)="toggleDropdown($event)"
          type="button"
          [attr.aria-expanded]="showDropdown">
    <div class="d-flex align-items-center">
      <i class="fas fa-money-bill-wave me-2"></i>
      <div class="text-start">
        <div class="currency-code fw-medium">{{ currentCurrency.code }}</div>
        <small class="currency-symbol text-muted">{{ currentCurrency.symbol }}</small>
      </div>
      <i class="fas fa-chevron-down ms-2" [class.rotate]="showDropdown"></i>
    </div>
  </button>
  
  <!-- Fixed position dropdown -->
  <div class="currency-dropdown-fixed" 
       *ngIf="showDropdown" 
       [style.top.px]="dropdownPosition.top"
       [style.left.px]="dropdownPosition.left"
       [style.minWidth.px]="dropdownPosition.width"
       (click)="$event.stopPropagation()">
    
    <!-- Mobile close button -->
    <div class="dropdown-header d-flex justify-content-between align-items-center d-md-none">
      <span class="fw-bold">Select Currency</span>
      <button class="btn-close" (click)="closeDropdown()"></button>
    </div>
    
    <!-- Desktop header -->
    <div class="dropdown-header d-none d-md-flex">
      <i class="fas fa-money-bill-wave me-2"></i>
      <span>Select Currency</span>
    </div>
    
    <div class="dropdown-divider"></div>
    
    <!-- Current selection for mobile -->
    <div class="current-selection-mobile p-3 d-block d-md-none">
      <div class="text-muted small mb-2">Currently selected:</div>
      <div class="d-flex align-items-center">
        <div class="currency-symbol-option badge bg-primary me-2">
          {{ currentCurrency.symbol }}
        </div>
        <div>
          <div class="fw-bold">{{ currentCurrency.code }}</div>
          <div class="text-muted small">{{ currentCurrency.name }}</div>
        </div>
      </div>
    </div>
    
    <!-- Currency list -->
    <div class="currency-list">
      <button class="currency-option" 
              *ngFor="let currency of currencies"
              (click)="selectCurrency(currency)"
              [class.active]="currency.code === currentCurrency.code">
        <div class="currency-info">
          <div class="d-flex align-items-center mb-1">
            <span class="currency-code-option fw-bold">{{ currency.code }}</span>
            <span class="currency-symbol-option ms-2 badge bg-light text-dark">
              {{ currency.symbol }}
            </span>
            <span class="ms-2 small text-muted d-none d-md-inline">
              {{ currency.symbolPosition === 'after' ? '(after)' : '(before)' }}
            </span>
          </div>
          <div class="currency-name text-muted small">{{ currency.name }}</div>
          <div class="exchange-rate text-muted small mt-1">
            {{ getExchangeRateInfo(currency) }}
          </div>
        </div>
        <div class="currency-selection">
          <i class="fas fa-check text-primary" *ngIf="currency.code === currentCurrency.code"></i>
        </div>
      </button>
    </div>
    
    <!-- Mobile footer with reload button -->
    <div class="dropdown-footer d-flex justify-content-between align-items-center d-block d-md-none">
      <small class="text-muted">
        <i class="fas fa-sync-alt me-1"></i>
        Page reload required
      </small>
      <button class="btn btn-sm btn-primary" (click)="reloadPage()">
        Apply & Reload
      </button>
    </div>
  </div>
</div>